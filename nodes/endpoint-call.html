<script type="text/javascript">
    RED.nodes.registerType('endpoint-call', {
        category: 'thinger',
        color: '#62b0fe', // #1F8EFE at 30% lightened
        defaults: {
            name: {value:""},
            endpoint: {value: ""},
            server: {type:"thinger-server", required:true}
        },
        icon:"server.svg",
        inputs: 1,
        outputs: 1,
        align: 'left',
        label: function() {
            return this.name || (this.endpoint ? this.endpoint : "endpoint call");
        },
        paletteLabel: function() {
            return "endpoint call";
        },
        oneditprepare: function() {

            const node_id = this.id;

            // Register focus handlers (options select)
            const optionsFields = ["endpoint"];
            ThingerDOM.registerFocusHandler(optionsFields, node_id);

        }
    });
</script>

<script type="text/x-red" data-template-name="endpoint-call">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-endpoint"><i class="fa fa-server"></i> Endpoint</label>
        <input type="text" id="node-input-endpoint" placeholder="Endpoint Identifier">
    </div>
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-server"></i> Server</label>
        <input type="text" id="node-input-server" placeholder="Select Server">
    </div>
</script>

<script type="text/markdown" data-help-name="endpoint-call">
Calls a server endpoint with the supplied input payload.

### Inputs

: endpoint (string) : the id of the endpoint to call.
: payload (object) : the payload of the message to send.

### Outputs

: payload (object) : the standard output of the command.

### Details
The node allows the configuration of the endpoint via the edit dialog or through an input message.
The values assigned through the dialog will have priority over the message.

The input `msg.payload` is not available through the edit dialog and can only be passed through the input.

### References

- [Thinger Node-RED Plugin]("https://docs.thinger.io/plugins/node-red") - full description of the plugin
- [GitHub]("https://github.com/thinger-io/Node-RED") - the nodes github repository
- [npm]("https://www.npmjs.com/package/node-red-contrib-thinger") - the nodes npm repository
- [Thinger.io]("https://thinger.io/") - the company behind the development
</script>
